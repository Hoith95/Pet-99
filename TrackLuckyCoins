local RS = game:GetService("ReplicatedStorage")
local Save = require(RS.Library.Client.Save) 

-- H√†m l·∫•y s·ªë l∆∞·ª£ng LuckyCoins
local function getLuckyCoins()
    local Inventory = Save.Get().Inventory
    for _, v in pairs(Inventory.Currency) do 
        if v.id == "LuckyCoins" then
            return v._am
        end
    end
    return 0
end

-- H√†m ch·∫°y script t·ª´ URL
local function runScript(url)
    local success, err = pcall(function()
        loadstring(game:HttpGet(url))()
    end)
    if success then
        print("‚úÖ ƒê√£ ch·∫°y script t·ª´:", url)
    else
        print("‚ö†Ô∏è L·ªói khi ch·∫°y script:", err)
    end
end

-- URL c·ªßa Script C/D
local scriptCD_URL = "https://raw.githubusercontent.com/Hoith95/Pet-99/main/JoinLow"

-- Tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa Coins
local isAbove10M = false
local isBelow1M = false
local lastChangeTime = os.time()  -- L∆∞u th·ªùi ƒëi·ªÉm cu·ªëi c√πng Coins thay ƒë·ªïi
local lastBelow1MTime = nil  -- Th·ªùi gian khi Coins xu·ªëng d∆∞·ªõi 1M

-- Theo d√µi thay ƒë·ªïi c·ªßa LuckyCoins
task.spawn(function()
    local prevCoins = getLuckyCoins()
    print("üöÄ B·∫Øt ƒë·∫ßu theo d√µi LuckyCoins. Coins hi·ªán t·∫°i:", prevCoins)

    while true do
        task.wait(60) -- Ki·ªÉm tra m·ªói 60 gi√¢y
        local currentCoins = getLuckyCoins()

        print("üîÑ LuckyCoins c·∫≠p nh·∫≠t: Tr∆∞·ªõc =", prevCoins, ", Hi·ªán t·∫°i =", currentCoins)

        -- N·∫øu Coins thay ƒë·ªïi, reset b·ªô ƒë·∫øm th·ªùi gian
        if currentCoins ~= prevCoins then
            lastChangeTime = os.time()
        end

        -- N·∫øu tr∆∞·ªõc ƒë√≥ tr√™n 10M nh∆∞ng gi·ªù d∆∞·ªõi 1M th√¨ ch·∫°y scriptCD
        if isAbove10M and currentCoins <= 1000000 then
            print("‚ö†Ô∏è Coins gi·∫£m xu·ªëng d∆∞·ªõi 1M! Ch·∫°y Script C/D...")
            runScript(scriptCD_URL)
            isAbove10M = false
            isBelow1M = true
            lastBelow1MTime = os.time() -- L∆∞u th·ªùi gian xu·ªëng d∆∞·ªõi 1M
        end

        -- N·∫øu tr∆∞·ªõc ƒë√≥ d∆∞·ªõi 1M nh∆∞ng gi·ªù v∆∞·ª£t qua 10M th√¨ ch·∫°y scriptCD
        if isBelow1M and currentCoins >= 10000000 then
            print("üéâ Coins tƒÉng l√™n tr√™n 10M! Ch·∫°y Script C/D...")
            runScript(scriptCD_URL)
            isAbove10M = true
            isBelow1M = false
            lastBelow1MTime = nil
        end

        -- N·∫øu qu√° 10 ph√∫t m√† Coins kh√¥ng thay ƒë·ªïi, ch·∫°y scriptCD
        if os.time() - lastChangeTime >= 600 then
            print("‚è≥ 10 ph√∫t kh√¥ng c√≥ thay ƒë·ªïi! Ch·∫°y Script C/D...")
            runScript(scriptCD_URL)
            lastChangeTime = os.time()
        end

        -- N·∫øu Coins d∆∞·ªõi 1M v√† trong 3 ph√∫t kh√¥ng tƒÉng l√™n √≠t nh·∫•t 1M, ch·∫°y scriptCD
        if isBelow1M and lastBelow1MTime and os.time() - lastBelow1MTime >= 180 then
            if currentCoins - prevCoins < 1000000 then
                print("‚è≥ Coins d∆∞·ªõi 1M v√† kh√¥ng tƒÉng l√™n √≠t nh·∫•t 1M trong 3 ph√∫t! Ch·∫°y Script C/D...")
                runScript(scriptCD_URL)
                lastBelow1MTime = os.time() -- Reset th·ªùi gian
            end
        end

        -- C·∫≠p nh·∫≠t tr·∫°ng th√°i
        if currentCoins >= 10000000 then
            isAbove10M = true
            isBelow1M = false
        elseif currentCoins <= 1000000 then
            if not isBelow1M then
                lastBelow1MTime = os.time() -- L∆∞u th·ªùi gian khi l·∫ßn ƒë·∫ßu xu·ªëng d∆∞·ªõi 1M
            end
            isBelow1M = true
            isAbove10M = false
        else
            isBelow1M = false
            lastBelow1MTime = nil
        end

        prevCoins = currentCoins
    end
end)
