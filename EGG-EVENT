local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Network = ReplicatedStorage:WaitForChild("Network")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local customEggsFolder = workspace:WaitForChild("__THINGS"):WaitForChild("CustomEggs")

-- ğŸ“Œ Táº¯t animation má»Ÿ trá»©ng
local Eggs = player:WaitForChild("PlayerScripts"):WaitForChild("Scripts"):WaitForChild("Game"):WaitForChild("Egg Opening Frontend")
getsenv(Eggs).PlayEggAnimation = function() return end

-- ğŸ“Œ Kiá»ƒm tra tÃªn mÃ£ hÃ³a
local function isEncodedName(name)
	return #name >= 32 and name:match("^[a-f0-9]+$") ~= nil
end

-- ğŸ“Œ TrÃ­ch sá»‘ tá»« "100x HUGE CHANCE!"
local function extractChanceValue(text)
	local num = text:match("(%d+)x%s+HUGE%s+CHANCE!?")
	return tonumber(num or "0")
end

-- ğŸ“Œ Teleport tá»›i egg
local function teleportToEgg(egg)
	local part = egg:FindFirstChildWhichIsA("BasePart", true)
	if part then
		hrp.CFrame = part.CFrame + Vector3.new(0, 5, 0)
		return true
	end
	return false
end

-- ğŸ“Œ TÃ¬m egg cÃ³ HUGE CHANCE cao nháº¥t tá»« list
local function findBestHugeChanceEgg(eggList)
	local bestEgg = nil
	local bestValue = -1

	for _, egg in ipairs(eggList) do
		local titleLabel = egg:FindFirstChild("Egg")
			and egg.Egg:FindFirstChild("EggInfo")
			and egg.Egg.EggInfo:FindFirstChild("Frame")
			and egg.Egg.EggInfo.Frame:FindFirstChild("Title")

		if titleLabel and titleLabel:IsA("TextLabel") then
			local content = titleLabel.ContentText
			local value = extractChanceValue(content)

			print(string.format("ğŸ” %s: %sx", egg.Name, value))
			if value > bestValue then
				bestEgg = egg
				bestValue = value
			end
		end
	end

	if bestEgg then
		print("ğŸ¯ Egg tá»‘t nháº¥t:", bestEgg.Name, "- HUGE CHANCE:", bestValue.."x")
	end

	return bestEgg, bestValue
end

-- ğŸ“Œ Danh sÃ¡ch egg Ä‘Ã£ biáº¿t
local knownEggs = {}

-- ğŸ“Œ ThÃªm cÃ¡c egg mÃ£ hÃ³a má»›i vÃ o knownEggs (khÃ´ng trÃ¹ng)
local function updateKnownEggs()
	for _, egg in ipairs(customEggsFolder:GetChildren()) do
		if isEncodedName(egg.Name) then
			local alreadyExists = false
			for _, e in ipairs(knownEggs) do
				if e == egg then
					alreadyExists = true
					break
				end
			end
			if not alreadyExists then
				table.insert(knownEggs, egg)
			end
		end
	end
end

-- ğŸš€ Khá»Ÿi Ä‘á»™ng láº§n Ä‘áº§u
updateKnownEggs()
for _, egg in ipairs(knownEggs) do
	teleportToEgg(egg)
	task.wait(0.2)
end

local currentEgg, currentValue = findBestHugeChanceEgg(knownEggs)
if not currentEgg then
	warn("âŒ KhÃ´ng tÃ¬m tháº¥y egg nÃ o cÃ³ HUGE CHANCE!")
	return
end

teleportToEgg(currentEgg)
task.wait(0.5)

-- â²ï¸ Kiá»ƒm tra láº¡i egg má»—i 300s
task.spawn(function()
	while true do
		task.wait(300) -- 5 phÃºt

		print("ğŸ” Äang cáº­p nháº­t egg má»›i...")
		updateKnownEggs()

		print("ğŸ§­ Tele láº§n lÆ°á»£t tá»›i tá»«ng egg Ä‘á»ƒ load thÃ´ng tin...")
		for _, egg in ipairs(knownEggs) do
			teleportToEgg(egg)
			task.wait(0.3)
		end

		local bestEgg, bestValue = findBestHugeChanceEgg(knownEggs)
		if bestEgg and bestValue > currentValue then
			print("ğŸŒŸ ÄÃ£ phÃ¡t hiá»‡n egg tá»‘t hÆ¡n:", bestEgg.Name, bestValue.."x")
			currentEgg = bestEgg
			currentValue = bestValue
			teleportToEgg(currentEgg)
			task.wait(0.5)
		else
			print("âœ… Váº«n tiáº¿p tá»¥c má»Ÿ egg hiá»‡n táº¡i:", currentEgg.Name, currentValue.."x")
		end
	end
end)

-- ğŸ” Má»Ÿ egg liÃªn tá»¥c
while true do
	local args = {
		[1] = currentEgg.Name,
		[2] = 89
	}
	game:GetService("ReplicatedStorage").Network.CustomEggs_Hatch:InvokeServer(unpack(args))
end
