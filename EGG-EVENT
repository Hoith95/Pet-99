local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Network = ReplicatedStorage:WaitForChild("Network")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local customEggsFolder = workspace:WaitForChild("__THINGS"):WaitForChild("CustomEggs")

-- ğŸ“Œ Lá»c tÃªn mÃ£ hÃ³a
local function isEncodedName(name)
	return #name >= 32 and name:match("^[a-f0-9]+$") ~= nil
end

-- ğŸ“Œ TrÃ­ch giÃ¡ trá»‹ tá»« "100x HUGE CHANCE!"
local function extractChanceValue(text)
	local num = text:match("(%d+)x%s+HUGE%s+CHANCE!?")
	return tonumber(num or "0")
end

-- ğŸ“Œ Tele tá»›i BasePart trong egg
local function teleportToEgg(egg)
	local part = egg:FindFirstChildWhichIsA("BasePart", true)
	if part then
		hrp.CFrame = part.CFrame + Vector3.new(0, 5, 0)
		return true
	end
	return false
end

-- ğŸ§  TÃ¬m egg mÃ£ hÃ³a cÃ³ HUGE CHANCE cao nháº¥t (sau khi tele tá»›i tá»«ng cÃ¡i)
local function findBestHugeChanceEgg()
	local bestEgg = nil
	local bestValue = -1

	for _, egg in ipairs(customEggsFolder:GetChildren()) do
		if isEncodedName(egg.Name) then
			-- ğŸš€ Tele tá»›i trÆ°á»›c Ä‘á»ƒ GUI hiá»‡n Ä‘áº§y Ä‘á»§
			if teleportToEgg(egg) then
				task.wait(0.4) -- chá» GUI load
			end

			local titleLabel = egg:FindFirstChild("Egg")
				and egg.Egg:FindFirstChild("EggInfo")
				and egg.Egg.EggInfo:FindFirstChild("Frame")
				and egg.Egg.EggInfo.Frame:FindFirstChild("Title")

			if titleLabel and titleLabel:IsA("TextLabel") then
				local content = titleLabel.ContentText
				local value = extractChanceValue(content)
				if value > bestValue then
					bestEgg = egg
					bestValue = value
				end
			end
		end
	end

	return bestEgg
end

-- ğŸ¥‡ TÃ¬m quáº£ trá»©ng cÃ³ HUGE CHANCE cao nháº¥t
local bestEgg = findBestHugeChanceEgg()
if not bestEgg then
	warn("âŒ KhÃ´ng tÃ¬m tháº¥y egg nÃ o cÃ³ HUGE CHANCE!")
	return
end

print("ğŸ¯ Chá»n egg:", bestEgg.Name)

-- ğŸ”’ Gáº¯n tÃªn egg cho AutoOpen sá»­ dá»¥ng
_G.TargetEggName = bestEgg.Name

-- âœ… Giá»¯ nguyÃªn pháº§n sau cá»§a báº¡n

-- Find nearest egg
local function find_nearest_egg()
	local nearestEgg, nearestDistance = nil, math.huge
	local eggsFolder = workspace.__THINGS:FindFirstChild("CustomEggs")
	if not eggsFolder then return nil end

	local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return nil end

	for _, eggModel in ipairs(eggsFolder:GetChildren()) do
		if eggModel:IsA("Model") and eggModel.Name == _G.TargetEggName then
			local success, cframe = pcall(function()
				return eggModel:GetBoundingBox()
			end)
			if success and cframe then
				local dist = (hrp.Position - cframe.Position).Magnitude
				if dist < nearestDistance then
					nearestEgg = eggModel.Name
					nearestDistance = dist
				end
			end
		end
	end

	return nearestEgg
end

-- Auto hatch nearest egg
local function GetMaxEggsToHatch()
	return 89
end

_G.AutoOpen = true
task.spawn(function()
	while task.wait() do
		if _G.AutoOpen then
			local nearestEgg = find_nearest_egg()
			if nearestEgg then
				pcall(function()
					Network:Invoke("CustomEggs_Hatch", nearestEgg, GetMaxEggsToHatch())
				end)
			end
		end
	end
end)
