local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Network = ReplicatedStorage:WaitForChild("Network")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local customEggsFolder = workspace:WaitForChild("__THINGS"):WaitForChild("CustomEggs")

-- ğŸ“Œ Lá»c tÃªn mÃ£ hÃ³a
local function isEncodedName(name)
	return #name >= 32 and name:match("^[a-f0-9]+$") ~= nil
end

-- ğŸš€ Teleport Ä‘áº¿n BasePart Ä‘áº§u tiÃªn
local function teleportToEgg(egg)
	local part = egg:FindFirstChildWhichIsA("BasePart", true)
	if part then
		hrp.CFrame = part.CFrame + Vector3.new(0, 5, 0)
		return true
	else
		warn("âŒ KhÃ´ng tÃ¬m tháº¥y part:", egg.Name)
		return false
	end
end

-- ğŸ” TrÃ­ch xuáº¥t sá»‘ x tá»« "1x HUGE CHANCE!", "100x HUGE CHANCE!"...
local function extractChanceValue(text)
	local num = text:match("(%d+)x%s+HUGE%s+CHANCE!?")
	return tonumber(num or "0")
end

-- ğŸ§  BÆ°á»›c 1: TÃ¬m táº¥t cáº£ egg mÃ£ hÃ³a cÃ³ "HUGE CHANCE!"
local hugeEggs = {}

for _, egg in ipairs(customEggsFolder:GetChildren()) do
	if isEncodedName(egg.Name) then
		local titleLabel = egg:FindFirstChild("Egg")
			and egg.Egg:FindFirstChild("EggInfo")
			and egg.Egg.EggInfo:FindFirstChild("Frame")
			and egg.Egg.EggInfo.Frame:FindFirstChild("Title")

		if titleLabel and titleLabel:IsA("TextLabel") then
			local content = titleLabel.ContentText
			local chanceValue = extractChanceValue(content)
			if chanceValue > 0 then
				table.insert(hugeEggs, {
					Name = egg.Name,
					Text = content,
					Value = chanceValue,
					Ref = egg
				})
			end
		end
	end
end

-- ğŸ¥‡ BÆ°á»›c 2: Chá»n quáº£ trá»©ng cÃ³ giÃ¡ trá»‹ lá»›n nháº¥t
table.sort(hugeEggs, function(a, b)
	return a.Value > b.Value
end)

if #hugeEggs == 0 then
	warn("âŒ KhÃ´ng tÃ¬m tháº¥y egg nÃ o cÃ³ HUGE CHANCE!")
	return
end

local bestEgg = hugeEggs[1]
print("ğŸ¯ Egg giÃ¡ trá»‹ cao nháº¥t:", bestEgg.Name, "|", bestEgg.Text)

-- ğŸš€ Teleport Ä‘áº¿n quáº£ trá»©ng Ä‘Ã³
teleportToEgg(bestEgg.Ref)

-- ğŸ¥š Báº¯t Ä‘áº§u tá»± Ä‘á»™ng má»Ÿ egg
_G.AutoOpen = true

local function GetMaxEggsToHatch()
	return 3 -- Báº¡n cÃ³ thá»ƒ thay báº±ng 1, 3 hoáº·c logic tá»± Ä‘á»™ng
end

task.spawn(function()
	while task.wait() do
		if _G.AutoOpen then
			pcall(function()
				Network:Invoke("CustomEggs_Hatch", bestEgg.Name, GetMaxEggsToHatch())
			end)
		end
	end
end)
