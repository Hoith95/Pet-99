local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Network = ReplicatedStorage:WaitForChild("Network")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local customEggsFolder = workspace:WaitForChild("__THINGS"):WaitForChild("CustomEggs")

-- 📌 Lọc tên mã hóa
local function isEncodedName(name)
	return #name >= 32 and name:match("^[a-f0-9]+$") ~= nil
end

-- 🚀 Teleport đến BasePart đầu tiên
local function teleportToEgg(egg)
	local part = egg:FindFirstChildWhichIsA("BasePart", true)
	if part then
		hrp.CFrame = part.CFrame + Vector3.new(0, 5, 0)
		return true
	else
		warn("❌ Không tìm thấy part:", egg.Name)
		return false
	end
end

-- 🔍 Trích xuất số x từ "1x HUGE CHANCE!", "100x HUGE CHANCE!"...
local function extractChanceValue(text)
	local num = text:match("(%d+)x%s+HUGE%s+CHANCE!?")
	return tonumber(num or "0")
end

-- 🧠 Bước 1: Tìm tất cả egg mã hóa có "HUGE CHANCE!"
local hugeEggs = {}

for _, egg in ipairs(customEggsFolder:GetChildren()) do
	if isEncodedName(egg.Name) then
		local titleLabel = egg:FindFirstChild("Egg")
			and egg.Egg:FindFirstChild("EggInfo")
			and egg.Egg.EggInfo:FindFirstChild("Frame")
			and egg.Egg.EggInfo.Frame:FindFirstChild("Title")

		if titleLabel and titleLabel:IsA("TextLabel") then
			local content = titleLabel.ContentText
			local chanceValue = extractChanceValue(content)
			if chanceValue > 0 then
				table.insert(hugeEggs, {
					Name = egg.Name,
					Text = content,
					Value = chanceValue,
					Ref = egg
				})
			end
		end
	end
end

-- 🥇 Bước 2: Chọn quả trứng có giá trị lớn nhất
table.sort(hugeEggs, function(a, b)
	return a.Value > b.Value
end)

if #hugeEggs == 0 then
	warn("❌ Không tìm thấy egg nào có HUGE CHANCE!")
	return
end

local bestEgg = hugeEggs[1]
print("🎯 Egg giá trị cao nhất:", bestEgg.Name, "|", bestEgg.Text)

-- 🚀 Teleport đến quả trứng đó
teleportToEgg(bestEgg.Ref)

-- 🥚 Bắt đầu tự động mở egg
_G.AutoOpen = true

local function GetMaxEggsToHatch()
	return 3 -- Bạn có thể thay bằng 1, 3 hoặc logic tự động
end

task.spawn(function()
	while task.wait() do
		if _G.AutoOpen then
			pcall(function()
				Network:Invoke("CustomEggs_Hatch", bestEgg.Name, GetMaxEggsToHatch())
			end)
		end
	end
end)
