local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Network = ReplicatedStorage:WaitForChild("Network")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local customEggsFolder = workspace:WaitForChild("__THINGS"):WaitForChild("CustomEggs")

-- ⚙️ Cấu hình
_G.AutoOpen = true
local EggAmount = 50         -- Số lượng mở mỗi lần
local HatchDelay = 1      -- Delay giữa mỗi lần mở

-- 📌 Tắt animation mở trứng
local Eggs = player:WaitForChild("PlayerScripts"):WaitForChild("Scripts"):WaitForChild("Game"):WaitForChild("Egg Opening Frontend")
getsenv(Eggs).PlayEggAnimation = function() return end

-- 📌 Kiểm tra tên mã hóa
local function isEncodedName(name)
	return #name >= 32 and name:match("^[a-f0-9]+$") ~= nil
end

-- 📌 Trích số từ "100x HUGE CHANCE!"
local function extractChanceValue(text)
	local num = text:match("(%d+)x%s+HUGE%s+CHANCE!?")
	return tonumber(num or "0")
end

-- 📌 Teleport tới egg
local function teleportToEgg(egg)
	local part = egg:FindFirstChildWhichIsA("BasePart", true)
	if part then
		hrp.CFrame = part.CFrame + Vector3.new(0, 5, 0)
		return true
	end
	return false
end

-- 📌 Tìm egg mã hóa có HUGE CHANCE cao nhất
local function findBestHugeChanceEgg()
	local bestEgg = nil
	local bestValue = -1

	for _, egg in ipairs(customEggsFolder:GetChildren()) do
		if isEncodedName(egg.Name) then
			teleportToEgg(egg)
			task.wait(0.3)

			local titleLabel = egg:FindFirstChild("Egg")
				and egg.Egg:FindFirstChild("EggInfo")
				and egg.Egg.EggInfo:FindFirstChild("Frame")
				and egg.Egg.EggInfo.Frame:FindFirstChild("Title")

			if titleLabel and titleLabel:IsA("TextLabel") then
				local content = titleLabel.ContentText
				local value = extractChanceValue(content)

				print(string.format("🔍 %s: %sx", egg.Name, value))
				if value > bestValue then
					bestEgg = egg
					bestValue = value
				end
			end
		end
	end

	if bestEgg then
		print("🎯 Egg tốt nhất:", bestEgg.Name, "- HUGE CHANCE:", bestValue.."x")
	end

	return bestEgg
end

-- 🥇 Tìm egg tốt nhất trước khi bắt đầu auto open
local bestEgg = findBestHugeChanceEgg()
if not bestEgg then
	warn("❌ Không tìm thấy egg nào có HUGE CHANCE!")
	return
end

-- 📌 Mở egg liên tục
task.spawn(function()
	while _G.AutoOpen do
		local args = {
			[1] = bestEgg.Name,
			[2] = EggAmount
		}
		local success, result = pcall(function()
			return Network.CustomEggs_Hatch:InvokeServer(unpack(args))
		end)
		if not success then
			warn("⚠️ Lỗi khi mở egg:", result)
		end
		task.wait(HatchDelay)
	end
end)
