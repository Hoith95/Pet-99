-- Ki·ªÉm tra bi·∫øn to√†n c·ª•c ƒë·ªÉ x√°c ƒë·ªãnh script ƒë√£ ch·∫°y hay ch∆∞a
if _G.WEBHOOKH then
    warn("Script ƒë√£ ƒë∆∞·ª£c ch·∫°y tr∆∞·ªõc ƒë√≥!")
    return -- D·ª´ng script n·∫øu ƒë√£ ch·∫°y
end

-- ƒê√°nh d·∫•u script ƒë√£ ƒë∆∞·ª£c ch·∫°y
_G.WEBHOOKH = true

getgenv().Webhook = {
    ['ID'] = "344054115539615745",
    ['Id Names'] = { "Huge", "Titanic"},
    ['URL'] = "https://discord.com/api/webhooks/1340432378417647636/gdWQzHXKXS2n3jXGhy3KUPWZ5G18Q1vzMpGMUeCuUb6Y2j3z4kHCpxxSPV4CTYurjb00",
}

repeat task.wait() until game:IsLoaded()
local LocalPlayer = game:GetService('Players').LocalPlayer
repeat task.wait() until not LocalPlayer.PlayerGui:FindFirstChild('__INTRO')

local Library = game.ReplicatedStorage.Library
local Client = Library.Client

local ExistCmds = require(Client.ExistCountCmds)
local RapCmds = require(Client.DevRAPCmds)
local Network = require(Client.Network)
local SaveMod = require(Client.Save)

local Formatint = function(int)
    local Suffix = {"", "k", "M", "B", "T", "Qd", "Qn", "Sx", "Sp", "Oc", "No", "De", "UDe", "DDe", "TDe", "QdDe", "QnDe", "SxDe", "SpDe", "OcDe", "NoDe", "Vg", "UVg", "DVg", "TVg", "QdVg", "QnVg", "SxVg", "SpVg", "OcVg", "NoVg", "Tg", "UTg", "DTg", "TTg", "QdTg", "QnTg", "SxTg", "SpTg", "OcTg", "NoTg", "QdAg", "QnAg", "SxAg", "SpAg", "OcAg", "NoAg", "e141", "e144", "e147", "e150", "e153", "e156", "e159", "e162", "e165", "e168", "e171", "e174", "e177", "e180", "e183", "e186", "e189", "e192", "e195", "e198", "e201", "e204", "e207", "e210", "e213", "e216", "e219", "e222", "e225", "e228", "e231", "e234", "e237", "e240", "e243", "e246", "e249", "e252", "e255", "e258", "e261", "e264", "e267", "e270", "e273", "e276", "e279", "e282", "e285", "e288", "e291", "e294", "e297", "e300", "e303"}
    local Index = 1
    
    if int < 999 then 
        return int
    end
    while int >= 1000 and Index < #Suffix do
        int = int / 1000
        Index = Index + 1
    end
    return string.format("%.2f%s", int, Suffix[Index])
end

local GetAsset = function(Id, pt)
    local Asset = require(Library.Directory.Pets)[Id]
    return string.gsub(Asset and (pt == 1 and Asset.goldenThumbnail or Asset.thumbnail) or "14976456685", "rbxassetid://", "")
end

local GetStats = function(Cmds, Class, ItemTable)
    return Cmds.Get({
        Class = { Name = Class },
        IsA = function(InputClass) return InputClass == Class end,
        GetId = function() return ItemTable.id end,
        StackKey = function()
            return game:GetService("HttpService"):JSONEncode({id = ItemTable.id, sh = ItemTable.sh, pt = ItemTable.pt, tn = ItemTable.tn})
        end
    }) or nil
end

local SendWebhook = function(Id, pt, sh)
    local Img = string.format("https://biggamesapi.io/image/%s", GetAsset(Id, pt))
    local Version = pt == 1 and "Golden " or pt == 2 and "Rainbow " or ""
    local Title = string.format("||%s|| v·ª´a nh·∫≠n ƒë∆∞·ª£c %s%s%s", LocalPlayer.Name, Version, sh and "Shiny " or "", Id)

    local Exist = GetStats(ExistCmds, "Pet", { id = Id, pt = pt, sh = sh, tn = nil })
    local Rap = GetStats(RapCmds, "Pet", { id = Id, pt = pt, sh = sh, tn = nil })

    local Body = game:GetService("HttpService"):JSONEncode({
        content = string.format("<@%s>", Webhook['ID']),
        embeds = {
            {
                title = Title,
                color = 0xFF00FF,
                timestamp = DateTime.now():ToIsoDate(),
                thumbnail = { url = Img },
                fields = {
                    { name = string.format("üíé Rap: ``%s`` \nüí´ Exist: ``%s``", Formatint(Rap or 0), Formatint(Exist or 0)), value = "" }
                },
                footer = { text = "Heo Notifier" }
            }
        }
    })
    
    local sus, err = pcall(function()
        return request({
            Url = Webhook['URL'],
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = Body
        })
    end)
end

-- L∆∞u s·ªë l∆∞·ª£ng Huge theo lo·∫°i
local HugeCount = {}

task.spawn(function()
    while true do
        -- L·∫•y inventory m·ªõi nh·∫•t
        local Inventory = SaveMod.Get()['Inventory']
        local CurrentCount = {}
        local NewHugeFound = false -- C·ªù ki·ªÉm tra c√≥ Huge m·ªõi kh√¥ng

        for Class, Items in pairs(Inventory) do
            for uid, v in pairs(Items) do
                if Class == "Pet" then
                    -- Ki·ªÉm tra n·∫øu pet thu·ªôc danh s√°ch Huge / Titanic
                    for _, name in ipairs(Webhook['Id Names']) do
                        if string.find(v.id, name) then
                            -- C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng pet theo lo·∫°i
                            CurrentCount[v.id] = (CurrentCount[v.id] or 0) + 1

                            -- N·∫øu lo·∫°i pet n√†y nhi·ªÅu h∆°n l·∫ßn tr∆∞·ªõc, c√≥ pet m·ªõi ho·∫∑c quay l·∫°i
                            if (HugeCount[v.id] or 0) < CurrentCount[v.id] then
                                SendWebhook(v.id, v.pt, v.sh)
                                NewHugeFound = true
                            end
                        end
                    end
                end
            end
        end

        -- N·∫øu s·ªë l∆∞·ª£ng gi·∫£m, c·∫≠p nh·∫≠t l·∫°i nh∆∞ng kh√¥ng g·ª≠i Webhook
        for id, count in pairs(HugeCount) do
            if (CurrentCount[id] or 0) < count then
                HugeCount[id] = CurrentCount[id] or 0
            end
        end

        -- N·∫øu c√≥ pet m·ªõi, c·∫≠p nh·∫≠t HugeCount
        if NewHugeFound then
            HugeCount = CurrentCount
        end

        -- ƒê·ª£i 5 gi√¢y tr∆∞·ªõc khi ki·ªÉm tra l·∫°i
        task.wait(5)
    end
end)
