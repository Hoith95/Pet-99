local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- GUI setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DiamondSenderGUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 300, 0, 180)
Frame.Position = UDim2.new(0.5, -150, 0.5, -90)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BorderSizePixel = 0
Frame.Visible = false
Frame.ZIndex = 1000
Frame.Parent = ScreenGui

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Text = "G·ª≠i Kim C∆∞∆°ng"
TitleLabel.Size = UDim2.new(1, 0, 0, 30)
TitleLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
TitleLabel.TextColor3 = Color3.new(1, 1, 1)
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.TextSize = 22
TitleLabel.ZIndex = 1001
TitleLabel.Parent = Frame

local UsernameBox = Instance.new("TextBox")
UsernameBox.PlaceholderText = "Nh·∫≠p t√™n ng∆∞·ªùi d√πng..."
UsernameBox.Size = UDim2.new(1, -20, 0, 40)
UsernameBox.Position = UDim2.new(0, 10, 0, 50)
UsernameBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
UsernameBox.TextColor3 = Color3.new(0, 0, 0)
UsernameBox.Text = ""
UsernameBox.Font = Enum.Font.SourceSans
UsernameBox.TextSize = 20
UsernameBox.ClearTextOnFocus = false
UsernameBox.ZIndex = 1001
UsernameBox.Parent = Frame

local SendButton = Instance.new("TextButton")
SendButton.Text = "G·ª¨I"
SendButton.Size = UDim2.new(1, -20, 0, 40)
SendButton.Position = UDim2.new(0, 10, 0, 110)
SendButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
SendButton.TextColor3 = Color3.new(1, 1, 1)
SendButton.Font = Enum.Font.SourceSansBold
SendButton.TextSize = 20
SendButton.ZIndex = 1001
SendButton.Parent = Frame

local ToggleButton = Instance.new("TextButton")
ToggleButton.Text = "‚ùå"
ToggleButton.Size = UDim2.new(0, 40, 0, 40)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.Font = Enum.Font.SourceSansBold
ToggleButton.TextSize = 22
ToggleButton.ZIndex = 1002
ToggleButton.Parent = ScreenGui

local isVisible = false
ToggleButton.MouseButton1Click:Connect(function()
	isVisible = not isVisible
	Frame.Visible = isVisible
	ToggleButton.Text = isVisible and "üëÅ" or "‚ùå"
end)

-- X·ª≠ l√Ω g·ª≠i
SendButton.MouseButton1Click:Connect(function()
	local UserName = UsernameBox.Text
	if UserName == "" then
		warn("B·∫°n ch∆∞a nh·∫≠p t√™n ng∆∞·ªùi d√πng.")
		return
	end

	local diamondsStat = player:FindFirstChild("leaderstats"):FindFirstChild("üíé Diamonds")
	if not diamondsStat then
		warn("Kh√¥ng t√¨m th·∫•y ch·ªâ s·ªë Diamonds.")
		return
	end

	local currentValue = diamondsStat.Value
	local AmountToSend = currentValue - 200000 -- G·ª≠i h·∫øt tr·ª´ 5tr

	if AmountToSend <= 0 then
		warn("‚ö†Ô∏è Kh√¥ng ƒë·ªß kim c∆∞∆°ng ƒë·ªÉ g·ª≠i.")
		return
	end

	-- T√πy ch·ªçn tin nh·∫Øn v√† config
	local msgTemplates = {
		"C·∫©n th·∫≠n x√†i nghen %s!",
		"Ch√∫c %s m·ªôt ng√†y vui v·∫ª nha!",
		"T·∫∑ng b·∫°n %s m·ªôt √≠t kim c∆∞∆°ng n√®!",
		"Mong %s d√πng ƒë√∫ng m·ª•c ƒë√≠ch :D",
	}
	local gemSettings = {
		Play_mail = true
	}

	-- Chu·∫©n b·ªã th∆∞ vi·ªán
	local Client = ReplicatedStorage:WaitForChild("Library"):WaitForChild("Client")
	local Network = require(Client.Network)
	local Save = require(Client.Save).Get()

	local diamondsUID = nil
	for uid, v in pairs(Save.Inventory["Currency"]) do
		if v.id == "Diamonds" then
			diamondsUID = uid
			break
		end
	end

	if not diamondsUID then
		warn("‚ùå Kh√¥ng t√¨m th·∫•y Diamonds UID")
		return
	end

	if gemSettings.Play_mail and diamondsStat.Value >= AmountToSend then
		diamondsStat.Value = diamondsStat.Value - AmountToSend
		local msg = string.format(msgTemplates[math.random(1, #msgTemplates)], UserName)

		local success, result = pcall(function()
			return Network.Invoke("Mailbox: Send", UserName, msg, "Currency", diamondsUID, AmountToSend)
		end)

		if success then
			warn("üì§ ƒê√£ g·ª≠i: " .. AmountToSend .. " ƒë·∫øn " .. UserName)
		else
			warn("‚ùå G·ª≠i th·∫•t b·∫°i: ", tostring(result))
		end
	else
		warn("‚ö†Ô∏è Kh√¥ng ƒë·ªß gem ƒë·ªÉ g·ª≠i ho·∫∑c Play_mail b·ªã t·∫Øt")
	end
end)
