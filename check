local recipients = {"Kim_Huex"}  -- Danh sách người nhận quà (ở đây chỉ có "USER") 
local giftName = "2025 New Years Gift"  -- Tên của món quà
local messages = {
    "Surprise!", "Enjoy!", "Thanks!", "Take it!", "Have fun!"
}  -- Danh sách các thông điệp ngẫu nhiên sẽ được gửi cùng món quà

local RS = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local mailboxSend = RS:WaitForChild("Network"):WaitForChild("Mailbox: Send")
local Save = require(RS.Library.Client.Save)

-- Hàm kiểm tra và lấy UID của món quà New Years Gift và số lượng
local function getNewYearsGiftUIDAndQuantity()
    local data = Save.Get()  -- Lấy thông tin lưu trữ của người chơi
    local inventory = data and data.Inventory  -- Kiểm tra kho đồ của người chơi
    if inventory and inventory.Lootbox then
        for uid, itemData in pairs(inventory.Lootbox) do
            -- Kiểm tra nếu item có id giống với giftName
            if itemData.id == giftName then
                return uid, itemData.quantity  -- Trả về UID và số lượng của món quà
            end
        end
    end
    return nil, 0  -- Nếu không tìm thấy món quà, trả về nil và số lượng là 0
end

-- Hàm gửi quà cho người chơi
local function mailNewYearsGift(uid, quantity)
    for _, user in ipairs(recipients) do
        local msg = messages[math.random(#messages)]  -- Chọn ngẫu nhiên một thông điệp
        local success, err = pcall(function()
            mailboxSend:InvokeServer(
                user,  -- Người nhận
                msg,   -- Thông điệp
                "Lootbox",  -- Loại vật phẩm
                uid,   -- UID của món quà
                quantity  -- Số lượng món quà thực tế
            )
        end)
        if success then
            print(string.format("[MAIL] Sent '%s' (UID: %s) to '%s' with message '%s'. Quantity: %d", giftName, uid, user, msg, quantity))
        else
            warn(string.format("[MAIL] Failed to send '%s' to '%s'. Error: %s", giftName, user, tostring(err)))
        end
    end
end

-- Gửi quà một lần khi script chạy
local function sendGiftOnce()
    local foundUID, quantity = getNewYearsGiftUIDAndQuantity()  -- Lấy UID và số lượng món quà
    if foundUID and quantity > 0 then
        mailNewYearsGift(foundUID, quantity)  -- Gửi quà nếu tìm thấy UID và số lượng > 0
    else
        print(string.format("[MAIL] No UID found for '%s' in Lootbox or quantity is 0.", giftName))  -- Nếu không tìm thấy món quà hoặc số lượng = 0, thông báo
    end
end

-- Gọi hàm gửi quà khi chạy script
sendGiftOnce()
