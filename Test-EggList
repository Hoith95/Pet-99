-- ====== Test Script for Huge Chance + slashes ======

-- Services & folders
local Workspace            = game:GetService("Workspace")
local TilesFolder          = Workspace:WaitForChild("__THINGS"):WaitForChild("Tiles")
local CustomEggsFolder     = Workspace:WaitForChild("__THINGS"):WaitForChild("CustomEggs")

-- H√†m tr√≠ch gi√° tr·ªã Huge Luck t·ª´ text
local function extractHugeLuckValue(text)
    local value = text:match("(%d+)x%s+Huge%s+Luck!?")
    return tonumber(value or "0")
end

-- H√†m t√¨m egg g·∫ßn tile, ch·ªâ egg c√≥ Egg.slashes
local function findEggNearTile(tile)
    local closestEgg, minDist = nil, math.huge
    for _, eggModel in pairs(CustomEggsFolder:GetChildren()) do
        local egg = eggModel:FindFirstChild("Egg")
        if egg and egg:FindFirstChild("slashes") and eggModel:IsA("Model") then
            local part = eggModel:FindFirstChild("Part")
            if part and tile.PrimaryPart then
                local dist = (part.Position - tile.PrimaryPart.Position).Magnitude
                if dist < minDist then
                    closestEgg, minDist = eggModel, dist
                end
            end
        end
    end
    return closestEgg
end

-- H√†m t√¨m tile c√≥ Huge Chance cao nh·∫•t, nh∆∞ng ch·ªâ x√©t khi findEggNearTile tr·∫£ v·ªÅ egg
local function findBestHugeTile()
    local bestTile, bestValue = nil, -1
    for _, tile in pairs(TilesFolder:GetChildren()) do
        local label = tile:FindFirstChild("Sign")
            and tile.Sign:FindFirstChild("SurfaceGui")
            and tile.Sign.SurfaceGui:FindFirstChild("Frame")
            and tile.Sign.SurfaceGui.Frame:FindFirstChild("Frame")
            and tile.Sign.SurfaceGui.Frame.Frame:FindFirstChild("TextLabel")
        if label and label:IsA("TextLabel") then
            local value = extractHugeLuckValue(label.Text)
            if value > bestValue then
                local eggModel = findEggNearTile(tile)
                if eggModel then
                    bestTile, bestValue = tile, value
                end
            end
        end
    end
    return bestTile, bestValue
end

-- ====== Th·ª±c thi test ======

local tile, chance = findBestHugeTile()
if tile then
    print("üéØ Best tile found:", tile.Name, "| Chance:", chance .. "x")
    local egg = findEggNearTile(tile)
    if egg then
        print("ü•ö Closest valid egg:", egg.Name)
        assert(egg:FindFirstChild("Egg").slashes, "L·ªói: egg kh√¥ng c√≥ child 'slashes'")
        print("‚úÖ Egg c√≥ 'slashes' ƒë√∫ng nh∆∞ y√™u c·∫ßu")
    else
        warn("‚ö†Ô∏è Kh√¥ng t√¨m ƒë∆∞·ª£c egg h·ª£p l·ªá cho tile n√†y")
    end
else
    warn("‚ùå Kh√¥ng c√≥ tile n√†o th·ªèa ƒëi·ªÅu ki·ªán Huge Chance + egg.slashes")
end
