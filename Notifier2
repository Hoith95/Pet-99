if _G.VAR_GUI_DEFAULT then
    warn("â›” GUI Default Ä‘Ã£ Ä‘Æ°á»£c cháº¡y trÆ°á»›c Ä‘Ã³!")
    return
end
_G.VAR_GUI_DEFAULT = true

-- ================= SERVICES =================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local Save = require(ReplicatedStorage.Library.Client.Save)

-- ================= UTIL =================
local function Formatint(int)
    local Suffix = {"", "k", "M", "B", "T", "Qd", "Qn", "Sx", "Sp", "Oc", "No", "De", "UDe", "DDe"}
    local Index = 1
    if int < 999 then return tostring(int) end
    while int >= 1000 and Index < #Suffix do
        int /= 1000
        Index += 1
    end
    return string.format("%.2f%s", int, Suffix[Index])
end

local function FormatTime(seconds)
    local h = math.floor(seconds / 3600)
    local m = math.floor((seconds % 3600) / 60)
    local s = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", h, m, s)
end

local function updateLabelSize(label)
    label.Size = UDim2.new(0, label.TextBounds.X + 20, 0, 38)
end

local function getMiscAmount(itemId)
    local Inventory = Save.Get().Inventory
    for _, v in pairs(Inventory.Misc) do
        if v.id == itemId then
            return tonumber(v._am) or 0
        end
    end
    return 0
end

local function getDiamondsFromLeaderstats()
    local stats = player:FindFirstChild("leaderstats")
    if stats then
        local diamonds = stats:FindFirstChild("ðŸ’Ž Diamonds")
        if diamonds then
            return diamonds.Value
        end
    end
    return 0
end

-- ================= GUI =================
local function startGuiDefault()
    local oldGui = playerGui:FindFirstChild("GuiDefault")
    if oldGui then oldGui:Destroy() end

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "GuiDefault"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui

    -- ===== REGION CREATOR =====
    local function createRegion(position, anchor, alignment, verticalAlign)
        local frame = Instance.new("Frame")
        frame.BackgroundTransparency = 1
        frame.Size = UDim2.new(0, 250, 1, 0)
        frame.Position = position
        frame.AnchorPoint = anchor
        frame.Parent = screenGui

        local layout = Instance.new("UIListLayout")
        layout.SortOrder = Enum.SortOrder.LayoutOrder
        layout.Padding = UDim.new(0, 3)
        layout.HorizontalAlignment = alignment
        layout.VerticalAlignment = verticalAlign
        layout.Parent = frame

        return frame
    end

    -- ðŸ”º FPS â€“ TOP RIGHT
    local topRightRegion =
        createRegion(
            UDim2.new(1, 0, 0, -60),
            Vector2.new(1, 0),
            Enum.HorizontalAlignment.Right,
            Enum.VerticalAlignment.Top
        )

    -- ðŸ”» BOTTOM REGIONS
    local rightRegion  = createRegion(UDim2.new(1, -10, 1, 0), Vector2.new(1, 1), Enum.HorizontalAlignment.Right, Enum.VerticalAlignment.Bottom)
    local centerRegion = createRegion(UDim2.new(0.5, 90, 1, 0), Vector2.new(0.5, 1), Enum.HorizontalAlignment.Center, Enum.VerticalAlignment.Bottom)
    local leftRegion   = createRegion(UDim2.new(0, 0, 1, 0), Vector2.new(0, 1), Enum.HorizontalAlignment.Left, Enum.VerticalAlignment.Bottom)

    -- ===== LABEL CREATOR =====
    local function createLabel(name, parent, bgColor)
        local label = Instance.new("TextLabel")
        label.Name = name
        label.Size = UDim2.new(1, 0, 0, 38)
        label.BackgroundColor3 = bgColor
        label.TextColor3 = Color3.new(1, 1, 1)
        label.Font = Enum.Font.GothamBold
        label.TextSize = 38
        label.BorderSizePixel = 0
        label.TextXAlignment = Enum.TextXAlignment.Center
        label.Text = "..."
        label.AutoLocalize = false
        label.Parent = parent
        return label
    end

    -- ===== LABELS =====
    local fpsLabel  = createLabel("FPSLabel",  topRightRegion, Color3.fromRGB(0, 102, 204))
    local timeLabel = createLabel("TimeLabel", centerRegion,   Color3.fromRGB(0, 102, 204))
    local mvpLabel  = createLabel("MvpLabel",  leftRegion,     Color3.fromRGB(34, 139, 34))
    local gemsLabel = createLabel("GemsLabel", leftRegion,     Color3.fromRGB(0, 102, 204))

    -- ===== FPS UPDATE =====
    local lastUpdate = tick()
    local frameCount = 0

    RunService.RenderStepped:Connect(function()
        frameCount += 1
        local now = tick()
        if now - lastUpdate >= 1 then
            local fps = frameCount / (now - lastUpdate)
            fpsLabel.Text = "FPS | " .. math.floor(fps + 0.5)
            updateLabelSize(fpsLabel)
            frameCount = 0
            lastUpdate = now
        end
    end)

    -- ===== LOOP =====
    local startTime = os.time()

    while true do
        pcall(function()
            timeLabel.Text = "TIME | " .. FormatTime(os.time() - startTime)
            updateLabelSize(timeLabel)

            gemsLabel.Text = "GEMS | " .. Formatint(getDiamondsFromLeaderstats())
            updateLabelSize(gemsLabel)

            mvpLabel.Text = "MVP KEY | " .. getMiscAmount("MVP Key")
            updateLabelSize(mvpLabel)
        end)
        task.wait(0.1)
    end
end

startGuiDefault()
