if _G.VAR_TIME_TRIAL_REWARD then
	warn("â›” Script Ä‘Ã£ Ä‘Æ°á»£c cháº¡y trÆ°á»›c Ä‘Ã³!")
	return
end

_G.VAR_TIME_TRIAL_REWARD = true

warn("ğŸ“¢ Script Time Trial Reward Ä‘ang khá»Ÿi Ä‘á»™ng...")

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local Save = require(game.ReplicatedStorage.Library.Client.Save)

-- âš™ï¸ HÃ m láº¥y Ä‘iá»ƒm Time Trial
local function getTimeTrialPoints()
	local saveData = Save.Get()
	local points = saveData and saveData.TimeTrialStats and (saveData.TimeTrialStats.Points or 0) or 0
	warn("ğŸ” [getTimeTrialPoints] Äiá»ƒm hiá»‡n táº¡i: " .. points)
	return points
end

-- âš™ï¸ HÃ m láº¥y sá»‘ lÆ°á»£t Ä‘Ã£ dÃ¹ng
local function getRunsUsed()
	local saveData = Save.Get()
	local runs = saveData and saveData.TimeTrialStats and (saveData.TimeTrialStats.DailyRuns or 0) or 0
	warn("ğŸ” [getRunsUsed] Sá»‘ lÆ°á»£t Ä‘Ã£ dÃ¹ng: " .. runs .. "/10")
	return runs
end

-- âš™ï¸ Teleport Ä‘áº¿n vá»‹ trÃ­ Ä‘á»•i quÃ 
local function teleportToRewardLocation()
	warn("ğŸš¶â€â™‚ï¸ Äang teleport Ä‘áº¿n vá»‹ trÃ­ Ä‘á»•i quÃ ...")
	game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-14223, 17.39, 1387)
end

-- âš™ï¸ HÃ m Ä‘á»•i quÃ 
local function openChest(chestType)
	local args = {
		[1] = chestType -- 1: há»™p 1 (1000), 2: há»™p 2 (3000), 3: há»™p 3 (5000)
	}
	game:GetService("ReplicatedStorage").Network.TimeTrials_OpenChest:InvokeServer(unpack(args))
end

-- âœ… Báº®T Äáº¦U
warn("ğŸ“¦ Ghi láº¡i vá»‹ trÃ­ ban Ä‘áº§u...")
local originalCFrame = character:WaitForChild("HumanoidRootPart").CFrame

-- â³ Äá»£i Ä‘áº¿n khi háº¿t lÆ°á»£t
warn("ğŸ•’ Kiá»ƒm tra lÆ°á»£t Time Trial...")
while true do
	local runs = getRunsUsed()
	if runs >= 10 then
		warn("âœ… ÄÃ£ dÃ¹ng háº¿t lÆ°á»£t Time Trial: " .. runs .. "/10")
		break
	end
	warn("â³ CÃ²n lÆ°á»£t Time Trial. Chá» 5 phÃºt trÆ°á»›c khi kiá»ƒm tra láº¡i...")
	task.wait(300) -- 5 phÃºt
end

-- ğŸ“Š Láº¥y Ä‘iá»ƒm hiá»‡n táº¡i
warn("ğŸ“Š Láº¥y thÃ´ng tin Ä‘iá»ƒm Time Trial...")
local points = getTimeTrialPoints()

-- ğŸ—“ï¸ Kiá»ƒm tra ngÃ y hÃ´m nay cÃ³ pháº£i thá»© 7 khÃ´ng
local currentDay = os.date("*t").wday -- 1=Chá»§ nháº­t, 7=Thá»© 7
local isSaturday = (currentDay == 7)

-- ğŸ§® TÃ­nh sá»‘ lÆ°á»£ng tá»«ng loáº¡i há»™p sáº½ Ä‘á»•i
local chest3, chest2, chest1 = 0, 0, 0

if isSaturday then
	warn("ğŸ“† HÃ´m nay lÃ  Thá»© 7 â†’ Äá»•i háº¿t toÃ n bá»™ Ä‘iá»ƒm.")
	chest3 = math.floor(points / 5000)
	points = points - chest3 * 5000

	chest2 = math.floor(points / 3000)
	points = points - chest2 * 3000

	chest1 = math.floor(points / 1000)
	points = points - chest1 * 1000
else
	warn("ğŸ“† HÃ´m nay KHÃ”NG pháº£i Thá»© 7 â†’ Chá»‰ Ä‘á»•i há»™p 3, giá»¯ Ä‘iá»ƒm dÆ°.")
	chest3 = math.floor(points / 5000)
end

warn("ğŸ§¾ Sá»‘ láº§n Ä‘á»•i quÃ  sáº½ thá»±c hiá»‡n:")
warn("ğŸ“¦ Há»™p 3 (5000): " .. chest3)
warn("ğŸ“¦ Há»™p 2 (3000): " .. chest2)
warn("ğŸ“¦ Há»™p 1 (1000): " .. chest1)

-- ğŸš€ Thá»±c hiá»‡n Ä‘á»•i quÃ  náº¿u cÃ³ Ã­t nháº¥t 1 há»™p
local totalChests = chest3 + chest2 + chest1

if totalChests > 0 then
	-- ğŸ—ºï¸ Teleport Ä‘áº¿n chá»— Ä‘á»•i quÃ 
	teleportToRewardLocation()
	task.wait(2)

	-- ğŸ Äá»•i láº§n lÆ°á»£t tá»«ng há»™p
	local function claimMultiple(count, chestType)
		for i = 1, count do
			warn("ğŸ” Äang thá»±c hiá»‡n Ä‘á»•i há»™p " .. chestType .. " - láº§n " .. i .. "...")
			local success, err = pcall(function()
				openChest(chestType)
			end)
			if success then
				warn("âœ… Äá»•i thÃ nh cÃ´ng há»™p " .. chestType .. " - láº§n " .. i)
			else
				warn("âŒ Lá»—i khi Ä‘á»•i há»™p " .. chestType .. ": " .. tostring(err))
			end
			task.wait(5)
		end
	end

	claimMultiple(chest3, 3)
	claimMultiple(chest2, 2)
	claimMultiple(chest1, 1)
else
	warn("âš ï¸ KhÃ´ng cÃ³ pháº§n thÆ°á»Ÿng nÃ o Ä‘á»§ Ä‘iá»ƒm Ä‘á»ƒ Ä‘á»•i.")
end

-- ğŸ Quay vá» vá»‹ trÃ­ ban Ä‘áº§u
warn("ğŸ”™ Quay vá» vá»‹ trÃ­ cÅ©...")
character:WaitForChild("HumanoidRootPart").CFrame = originalCFrame

warn("ğŸ‰ ÄÃ£ hoÃ n táº¥t toÃ n bá»™ quÃ¡ trÃ¬nh Ä‘á»•i quÃ  Time Trial.")
