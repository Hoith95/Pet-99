-- Kiểm tra PlaceId và kick nếu có người khác (ngoại trừ LocalPlayer)
if _G.CHECK_HEO_SCRIPT then
    warn("Script CHECK_HEO_SCRIPT đã chạy trước đó!")
    return
end
_G.CHECK_HEO_SCRIPT = true

local TARGET_PLACE = 140403681187145

-- Tuỳ chọn: giới hạn thời gian chờ (giây). Đặt = nil để chờ vô hạn.
local WAIT_TIMEOUT = 3600

-- Đợi game load xong
repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer
if not localPlayer then
    warn("LocalPlayer chưa sẵn sàng. Dừng script.")
    return
end

-- Nếu không đúng PlaceId thì dừng luôn
if game.PlaceId ~= TARGET_PLACE then
    warn("Không phải PlaceId mục tiêu. Dừng script.")
    return
end

-- Hàm kiểm tra presence của player khác và kick nếu có
local function checkAndKickIfOther()
    local hasOther = false
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= localPlayer then
            hasOther = true
            break
        end
    end

    if hasOther then
        -- pcall để an toàn, tránh lỗi gây crash script
        pcall(function()
            localPlayer:Kick("Có Heo Khác")
        end)
    else
        print("Chỉ có mình bạn trong server. Dừng script.")
    end
end

-- Nếu đã hoàn thành Time Trial thì kiểm tra ngay
if _G.Time_Trial_Done == true then
    task.wait(60)
    checkAndKickIfOther()
    return
end

-- Nếu chưa hoàn thành, chờ tới khi _G.Time_Trial_Done = true rồi kiểm tra
local startTime = os.time()
while not _G.Time_Trial_Done do
    task.wait(1)
    if WAIT_TIMEOUT and (os.time() - startTime) >= WAIT_TIMEOUT then
        warn("Hết thời gian chờ _G.Time_Trial_Done. Bắt đầu kiểm tra.")
        checkAndKickIfOther()
        return
    end
end

-- Khi tới đây _G.Time_Trial_Done == true
checkAndKickIfOther()
