local RS = game:GetService("ReplicatedStorage")
local Save = require(RS.Library.Client.Save) 

-- H√†m l·∫•y s·ªë l∆∞·ª£ng LuckyCoins
local function getLuckyCoins()
    local Inventory = Save.Get().Inventory
    for _, v in pairs(Inventory.Currency) do 
        if v.id == "LuckyCoins" then
            return v._am
        end
    end
    return 0
end

-- URLs c·ªßa c√°c ph∆∞∆°ng √°n ƒë·ªïi server
local scriptJoinLow_URL = "https://raw.githubusercontent.com/Hoith95/Pet-99/main/JoinLow"
local scriptBackup1_URL = "https://raw.githubusercontent.com/Hoith95/Pet-99/main/ServerHop3"
local scriptBackup2_URL = "https://raw.githubusercontent.com/Hoith95/Pet-99/main/ServerHop-W1"

-- L∆∞u ServerId hi·ªán t·∫°i
local initialServerId = game.JobId

-- H√†m ch·∫°y script v√† ch·ªù 30 gi√¢y ki·ªÉm tra server
local function runScriptAndCheck(url)
    print("üöÄ Ch·∫°y script:", url)
    pcall(function()
        loadstring(game:HttpGet(url))()
    end)
    
    task.wait(30) -- Ch·ªù 30 gi√¢y sau khi ch·∫°y script
    
    if game.JobId ~= initialServerId then
        print("‚úÖ ƒê√£ ƒë·ªïi server th√†nh c√¥ng!")
        return true
    else
        print("‚ö†Ô∏è V·∫´n ·ªü server c≈©!")
        return false
    end
end

-- üõ† L·∫•y l∆∞·ª£ng Coins ban ƒë·∫ßu
local initialCoins = getLuckyCoins()
_G.COINS10M = initialCoins >= 10000000
_G.COINS0M = initialCoins < 10000000

print("üöÄ Script b·∫Øt ƒë·∫ßu ch·∫°y! Coins ban ƒë·∫ßu:", initialCoins)
print("üìå G√°n bi·∫øn _G:", _G.COINS10M and "_G.COINS10M = true" or "_G.COINS0M = true")

-- üï∞ ƒê·ª£i 5 ph√∫t tr∆∞·ªõc khi ki·ªÉm tra s·ª± thay ƒë·ªïi
task.wait(300)

-- üîÑ Theo d√µi s·ª± thay ƒë·ªïi c·ªßa Coins
local prevCoins = initialCoins
local lastChangeTime = os.time()

while true do
    task.wait(60) -- Ki·ªÉm tra m·ªói 60 gi√¢y
    local currentCoins = getLuckyCoins()
    print("üîÑ LuckyCoins c·∫≠p nh·∫≠t: Tr∆∞·ªõc =", prevCoins, ", Hi·ªán t·∫°i =", currentCoins)

    -- N·∫øu Coins tƒÉng l√™n, ki·ªÉm tra ƒë·∫°t m·ªëc 50M ch∆∞a
    if currentCoins > prevCoins then
        print("üìà Coins ƒëang tƒÉng!")
        if currentCoins >= 50000000 then
            print("üéâ Coins ƒë·∫°t 50M! Ch·∫°y Script JoinLow...")
            runScriptAndCheck(scriptJoinLow_URL)
            break
        end
    end

    -- N·∫øu Coins gi·∫£m xu·ªëng, ki·ªÉm tra ƒë·∫°t m·ªëc 1M ch∆∞a
    if currentCoins < prevCoins then
        print("üìâ Coins ƒëang gi·∫£m!")
        if currentCoins <= 1000000 then
            print("‚ö†Ô∏è Coins gi·∫£m v·ªÅ 1M! Ch·∫°y Script JoinLow...")
            runScriptAndCheck(scriptJoinLow_URL)
            break
        end
    end

    -- N·∫øu Coins kh√¥ng thay ƒë·ªïi trong 5 ph√∫t, th·ª±c hi·ªán ƒë·ªïi server theo ph∆∞∆°ng √°n d·ª± ph√≤ng
    if os.time() - lastChangeTime >= 300 then
        print("‚è≥ Coins kh√¥ng thay ƒë·ªïi trong 5 ph√∫t! Th·ª≠ ƒë·ªïi server...")

        -- Th·ª±c hi·ªán l·∫ßn l∆∞·ª£t c√°c ph∆∞∆°ng √°n ƒë·ªïi server
        if not runScriptAndCheck(scriptJoinLow_URL) then
            if not runScriptAndCheck(scriptBackup1_URL) then
                if not runScriptAndCheck(scriptBackup2_URL) then
                    print("üö® Kh√¥ng th·ªÉ ƒë·ªïi server! Kick kh·ªèi game...")
                    game.Players.LocalPlayer:Kick("Heo")
                end
            end
        end
        break
    end

    -- C·∫≠p nh·∫≠t tr·∫°ng th√°i
    if currentCoins ~= prevCoins then
        lastChangeTime = os.time()
    end
    prevCoins = currentCoins
end
